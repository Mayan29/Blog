# 第一章 AV Foundation 简介

1991 年苹果推出了 Quick Time 首次将数字音频和数字视频展现在用户面前，Quick Time 架构在之后 20 年间给数字多媒体这一领域带来了变革，对教育、游戏、娱乐产业的发展影响巨大。但是随着时间的推移，缺点也越来越多，于是苹果推出了一个新的框架，它就是 AV Foundation

## 1 AV Foundation 层级

AV Foundation 是用于处理基于时间的视听数据的高级框架。下图展示了 AV Foundation 在整个体系中所处的角色。

![pic00](https://github.com/Mayan29/ReadingNotes/blob/master/04.《AV%20Foundation%20开发秘籍》读书笔记/DATA/pic00.png) 

> ### Core Audio
>
> Core Audio 是由多个框架整合在一起的总称，为音频和 MIDI 内容的录制、播放和处理提供相应接口。Core Audio 也提供高层级的接口，比如通过 Audio Queue Services 框架，处理基本的音频播放和录音功能。同时也提供相对低层级的接口，尤其是 Audio Units 接口，提供了针对音频信号进行完全控制的功能，并通过 Audio Units 构建一些复杂的音频处理模式。如果想详细了解这一框架，建议阅读由 Chirs Adamson 和 Kevin Avila 撰写的 Learning Core Audio 一书。
>
> ### Core Video
>
> Core Video 是针对数字视频所提供的管道模式，为其相对的 Core Media 提供图片缓存和缓存池支持，提供了一个能够对数字视频逐帧访问的接口。该框架通过像素格式之间的转换并管理视频同步事项，使得复杂的工作得到了有效简化。
>
> ### Core Media
>
> Core Media 是 AV Foundation 所用到的低层级媒体管道的一部分。它提供针对音频样本和视频帧处理所需的低层级数据类型和接口。Core Media 还提供了基于 CMTime 数据类型的时基模型。
>
> ### Core Animation
>
> Core Animation 是合成及动画相关框架，主要功能就是提供美观、流畅的动画效果。对于视频内容的播放和视频捕获，AV Foundation 提供了硬件加速机制来对整个流程进行优化。AV Foundation 还可以利用 Core Animation 让开发者能够在视频编辑和播放过程中添加动画标题和图片效果。

处于高层级框架和低层级框架之间就是 AV Foundation，其提供了很多低层级框架才能实现的功能和性能，并且是以更简单的 OC 接口方式实现的。同时它也可以和高层级的框架无缝连接，比如 Media Player 和 Assets Library，使用这两个框架所提供的服务，也可以直接和 Core Media 和 Core Audio 进行交互。

## 2 AV Foundation 框架

AV Foundation 框架包含 100 多个类，如果将其按照功能单元进行分解，就会变得比较容易理解：

### 音频播放和记录

如上图所示 AV Foundation 方框右上角有一个小方格被单独标记为音频专用类，这是由 AV Foundation 提供的关于音频处理的一些早期功能。AVAudioPlayer 和 AVAudioRecorder 可以提供一种更简单的整合音频播放和记录的功能，但是并不是 AV Foundation 用于播放和记录音频的唯一方式，却是最容易学习、功能最强大的方法。

### 媒体文件检查

AV Foundation 提供检查正在使用的媒体文件的功能，比如是否可以用于回放，或者是否可以被编辑和导出，还可以获取内容持续时间，创建日期，首选播放音量。此外，该框架还基于 AVMetadataItem 类提供强大的元数据支持，这就允许开发者读写关于媒体资源的描述信息，比如唱片簿和艺术家信息。

### 视频播放

这是 AV Foundation 提供的最常用的功能，这一部分的核心类是 AVPlayer 和 AVPlayerItem，这两个类让你能够对资源的播放进行控制。

### 媒体捕捉

AV Foundation 提供了丰富的 API 集可以对摄像头等设备进行精密控制。摄像头捕捉的核心类是 AVCaptureSession，其作为所有活动的汇集点来接收摄像头设备由各路流发过来的视频和图片。

### 媒体编辑

AV Foundation 可以将多个音频和视频资源进行组合，允许修改和编辑独立的媒体片段、随时修改音频文件的参数以及添加动画标题和场景切换效果。

### 媒体处理

使用 AVAssetReader 和 AVAssetWritere 类来执行更高级的媒体处理任务，这些类可以直接访问视频帧和音频样本。

## 3 数字媒体简介

虽然我们处在一个数字化的时代，但是我们还是更习惯模拟信息的世界。我们看到的和听到的都是通过模拟信号传递给我们，信号的频率和强度是在不断变化的。但是数字世界的信号是离散的，由 1 和 0 组成。将模拟信号转换成我们能够存储并传输的数字信号，要进过模数转换，我们将这个过程称为采样（Sampling）。

### 数字媒体采样

对媒体内容数字化主要有两种方式。第一种称为时间采样，这种方法捕捉一个信号周期内的变化。第二种称为空间采样，一般用在图片数字化和其他可视化媒体内容数字化的过程中。空间采样包含对一幅图片在一定分辨率之下捕捉其亮度和色度，进而创建由该图片的像素点数据所构成的数字化结果。

### 数字媒体压缩 - 色彩二次抽样















