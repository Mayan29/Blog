# 第三章 资源和元数据

## 1. 资源简介

AV Foundation 把所有的代码设计围绕资源（assert）进行，AVAssert 是 AV Foundation 设计的核心。

AVAssert 不需要考虑的两个重要范畴：第一、它提供了对基本媒体格式的层抽象，这意味着无论是处理 MPEG-4 视频还是 MP3 音频，对你而言面对的只有资源这个概念。第二、不用我们管理资源的位置信息，不管是本地 URL 还是远程服务器上的一个音频流、视频流的 URL。

AVAssert 本身并不是媒体资源，但是它可以作为时基媒体的容器，它由一个或多个带有描述自身元数据的媒体组成。我们使用 AVAssetTrack 类代表保存在资源中的统一类型媒体，并对每个资源建立相应的模型。AVAssetTrack 最常见的形态就是音频和视频流，但是它还可以表示文本、副标题或隐藏字幕等媒体类型。

## 2. 资源创建

为一个媒体资源创建 AVAsset 对象时，可以通过 URL 对它进行初始化来实现，可以是本地 URL，也可以是远程资源的 URL

```objc
NSURL *url = [NSURL URLWithString:@""];
AVAsset *asset = [AVAsset assetWithURL:url];
```

AVAsset 是一个抽象类，意味着不能直接被实例化。当创建实例时，实际上是创建了它子类的一个实例，子类名为 AVURLAsset。有时我们会直接使用这个类，因为它允许通过传递选项字典来精细调整资源的创建方式。比如，如果创建一个用在音频或视频编辑场景中的资源，希望传递一个选项来告诉程序提供更精确的时长和计时信息：

```objc
NSURL *url = [NSURL URLWithString:@""];
NSDictionary *options = @{AVURLAssetPreferPreciseDurationAndTimingKey : @YES};
AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:url options:options];
```

## 3. 异步载入

AVAsset 具有多种方法和属性，可以提供有关资源的信息，比如时长、创建日期和元数据等。AVAsset 使用了一种高效的设计方法，延迟载入资源属性，直到请求时才载入，这样就可以快速创建资源。不过属性的访问是同步发生的，如果正在请求的属性没有预先载入，程序就会阻塞，所以开发者应该使用异步来查询资源的属性。
    
